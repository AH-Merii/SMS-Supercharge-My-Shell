##### Keybindings #####
# Vim-style pane movement
bind -N "Select left pane" h select-pane -L
bind -N "Select pane below" j select-pane -D
bind -N "Select pane above" k select-pane -U
bind -N "Select right pane" l select-pane -R

# Split windows keeping cwd
bind -N "Split vertically (keep cwd)" '"' split-window -v -c "#{pane_current_path}"
bind -N "Split horizontally (keep cwd)" %   split-window -h -c "#{pane_current_path}"

# Switch windows
bind -N "Previous window" -n S-Left  previous-window
bind -N "Next window" -n S-Right next-window
bind -N "Previous window" -n M-H     previous-window
bind -N "Next window" -n M-L     next-window

# Copy-mode (vi)
bind-key -N "Begin selection" -T copy-mode-vi v   send-keys -X begin-selection
bind-key -N "Toggle rectangle selection" -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -N "Copy selection and cancel" -T copy-mode-vi y   send-keys -X copy-selection-and-cancel

##### Splits
# Alt+v → vertical split (top/bottom) with same starting path as current pane
bind -N "Split vertically (keep cwd)" -n M-s split-window -v -c "#{pane_current_path}"
# Alt+s → horizontal split (left/right) with same starting path as current pane 
bind -N "Split horizontally (keep cwd)" -n M-v split-window -h -c "#{pane_current_path}"

#### Helpers
# Quick helper shortcut to open man page
bind -N "Open man page in popup" m command-prompt -p "man page for:" "display-popup -E -e MANPAGER='nvim +Man!' -w 80% -h 80% 'man %%"
bind -N "Open tmux man page" M display-popup -E -w 80% -h 80% -e MANPAGER="nvim +Man!" 'man tmux'

# prefix-R → Reload config and plugins with centered popup
unbind-key R
bind -N "Reload config and plugins" R display-popup -T "Reload Config" "sh -lc '
  printf \"\033[38\;5\;80m󰣖 Reloading tmux configuration...\033[38\;2\;139\;213\;202m\n\n\";
  
  tmux source-file ~/.config/tmux/tmux.conf;
  tmux run-shell ~/.config/tmux/plugins/tpm/bin/install_plugins;
  
  printf \"\n\033[32m Tmux config & plugins reloaded successfully!\033[0m\n\";
  printf \"\nPress any key to close...\n\";
'"

##### Windows & Sessions
# Alt+n → new window with same starting path as current pane
bind -N "New window (keep cwd)" -n M-n new-window -c "#{pane_current_path}"
# Alt+N → new session
bind -N "Create new session" -n M-N new-session

##### Rename (pane/window)
# Alt+r → rename current session
bind -N "Rename current session" -n M-R command-prompt -I "#S" -p "Rename session:" 'rename-session "%%"'
# Alt+R → rename current window (pre-fill with current name)
bind -N "Rename current window" -n M-r command-prompt -I "#W" -p "Rename window:" 'rename-window "%%"'

##### Close (pane/window)
# Alt+c → close pane
bind -N "Kill current pane" -n M-q kill-pane
# Alt+C → close window
bind -N "Kill current window" -n M-Q kill-window

##### Close (session/server) — with confirmation prompts
# Alt+x → kill current session (prompt)
bind -N "Kill current session" -n M-x confirm-before -p "Kill tmux session? (y/N)" "kill-session"
# Alt+X → kill tmux server (prompt)
bind -N "Kill tmux server" -n M-X confirm-before -p "Kill tmux server? (y/N)" "kill-server"
