##### TPM and Plugins #####
set-environment -g TMUX_PLUGIN_MANAGER_PATH $XDG_CONFIG_HOME/tmux/plugins/

# Install TPM if not found
if-shell 'test ! -d "${TMUX_PLUGIN_MANAGER_PATH}/tpm"' {
  run-shell 'printf " Installing Tmux Package Manager (TPM)...\n"'
  run-shell 'mkdir -p "${TMUX_PLUGIN_MANAGER_PATH}"'
  run-shell 'git clone https://github.com/tmux-plugins/tpm "${TMUX_PLUGIN_MANAGER_PATH}/tpm"'
  run-shell '${TMUX_PLUGIN_MANAGER_PATH}/tpm/bin/install_plugins'
  run-shell 'printf " TPM installed successfully!\n"'
}

##### Sesh (auto-install if missing) #####
if-shell 'command -v sesh >/dev/null 2>&1' {
  run-shell 'printf "Already installed \"sesh\"\n"'
} {
  if-shell 'command -v brew >/dev/null 2>&1' {
    run-shell 'printf " Installing sesh (smart session manager) using Homebrew...\n"'
    run-shell 'brew install sesh'
    if-shell 'command -v sesh >/dev/null 2>&1' \
      'run-shell "printf \"✅ sesh installed successfully via Homebrew.\\n\""' \
      'run-shell "printf \"❌ sesh installation failed. Please check your Homebrew setup.\\n\""' 
  } {
    run-shell 'printf "❌ Homebrew not found. Please install Homebrew first"'
  }
}

run-shell ~/.config/tmux/scripts/configure-sesh-tmux-bindings.sh

# Plugin list
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'
set -g @plugin 'dreknix/tmux-primary-ip'
set -g @plugin 'omerxx/tmux-floax'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Make sure to install catpuccine/tmux manually if not found
if-shell 'test ! -d "${TMUX_PLUGIN_MANAGER_PATH}/catppuccin"' {
  run-shell 'printf "  Installing Catppuccin Theme...\n"'
  run-shell 'mkdir -p "${TMUX_PLUGIN_MANAGER_PATH}/catppuccin"'
  run-shell 'git clone https://github.com/catppuccin/tmux.git "${TMUX_PLUGIN_MANAGER_PATH}/catppuccin/tmux"'
  run-shell 'printf "  Catppuccin installed successfully!\n"'
}

# Catppuccin theme
source-file ~/.config/tmux/theme.tmux.conf

# Plugin configs
# Floating Terminal
set -g @floax-width '80%'
set -g @floax-height '80%'
set -g @floax-border-color 'magenta'
set -g @floax-text-color 'blue'
set -g @floax-bind 'f'
set -g @floax-change-path 'true'

set -g status-interval 3 # change status interval to update more frequently

# Continuum
# Automatically restore sessions using continuum after killing tmux server
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'

# Resurrect
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-save-bash-history 'on'
set -g @resurrect-dir $XDG_CONFIG_HOME/tmux/resurrect
set -g @resurrect-strategy-vim 'session'

# Run TPM
run $TMUX_PLUGIN_MANAGER_PATH/tpm/tpm
